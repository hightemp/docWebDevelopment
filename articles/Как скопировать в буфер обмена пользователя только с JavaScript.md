# Как скопировать в буфер обмена пользователя только с JavaScript 

### Мне нужно быть честным, это действительно не один API.

API буфера обмена состоит из нескольких API. Но более того, нам нужно задействовать еще несколько веб-API, которые напрямую не связаны с буфером обмена и его утилитами, чтобы полностью использовать все возможности браузера в буфере обмена. , К концу у вас должно появиться несколько новых инструментов, облегчающих работу с текстом на ваших сайтах и ​​в приложениях!

* * *

####  **Начиная с малого: ClipboardEvent** 

Событие буфера обмена является самым простым в использовании и технически создается с помощью [реального API буфера обмена](https://developer.mozilla.org/en-US/docs/Web/API/ClipboardEvent/ClipboardEvent), но здесь Дилемма: API-интерфейс буфера обмена не раскрывается в большинстве веб-браузеров. Таким образом, вы можете получить доступ к нему только через обработчики событий для событий `copy`,` cut` и `paste`.

Это означает, что вы можете изменить то, что происходит во время этих событий. Ваш код может изменить как то, что в конечном итоге попадает в буфер обмена пользователя, так и то, что в итоге отображается на экране. Однако вы не можете создать свое собственное событие, [кроме Firefox](http://caniuse.com/#search=clipboardevent).

 **Итак ... Что мы можем даже сделать при этих ограничениях?** 

Как оказалось, много!

Я могу придумать несколько причин для изменения этих событий, и я приведу примеры ниже.

* Добавить или удалить что-то из скопированного или вырезанного текста.
* Получить данные, которые были вставлены и использовать его в другом месте в вашем приложении.

Это не обязательно _lot_, но с некоторым дополнительным соком API мы можем улучшить наши возможности. Подробнее об этом позже.

 **Давайте посмотрим на некоторые примеры.** 

Это действительно не остановит людей от копирования вашего текста, но показывает, как оно переопределяет первоначальное значение.

В приведенном выше примере все, что вам нужно сделать, это добавить eventListener к событию копирования. Полученное событие содержит `clipboardData` и его три метода:` setData`, `getData` и` clearData`.

На самом деле он имеет все методы и свойства объекта [DataTransfer](https://html.spec.whatwg.org/multipage/interaction.html#datatransfer). Таким образом, вы можете проверить свойства `items` и` types`, если вы не уверены, какие аргументы использовать для `setData` или` getData`.

Не позволяйте пользователю вставлять в поле ввода подтверждения или не позволяйте ему вставлять свой собственный пароль.

В этом примере показано, как будет выглядеть, если пользователь не сможет вставить текст во входные данные с идентификатором «passwordConfirmation». Это также не позволяет им вставлять « theUserPassword» в любое поле (мы притворяемся, что это фактически их пароль. Пожалуйста, на мгновение не обращайте внимания на то, что у вас никогда не должно быть пароля пользователя открытым текст в вашем веб-приложении.)

Другим примером может быть фильтр ненормативной лексики, если вы создаете веб-приложение, которое ожидает молодых пользователей.

Вы можете продолжить использовать значение, полученное из `getData` в другом месте вашего приложения. В качестве примера, возможно, вам нужно войти в систему, когда данные вставлены, как в тестовом приложении. Иногда вставка текста в этом параметре может быть в порядке, но вы можете захотеть вернуться позже и убедиться, что вставленное содержимое не было скопировано из другого места.

* * *

### Создание собственной копии мероприятия.

> Копирование текста в буфер обмена не должно быть трудным. Не требуется десятков шагов для настройки или сотен килобайт для загрузки. Но, прежде всего, это не должно зависеть от Flash или любого раздутого фреймворка. - [clipboardjs.com](https://clipboardjs.com/ "https://clipboardjs.com/" )

Прежде чем мы углубимся в это, я хотел бы представить вам проект с открытым исходным кодом, который упрощает все, что я собираюсь показать вам. Он называется «clipboard.js» и позволяет легко копировать текст в буфер обмена. Возможно, вам будет проще, чем делать это самостоятельно. Это довольно маленькая библиотека с очень простым API.

Но мы здесь, чтобы учиться, поэтому давайте посмотрим, как вы можете копировать текст в буфер обмена пользователя, используя только веб-API.

Поскольку объект `ClipboardEvent` не доступен в большинстве браузеров, мы должны пойти другим путем. Для этого нам необходимо добавить в наши инструменты `document.execCommand ()`. Это позволит нам выполнить команду `copy`, которая копирует текущий выбор на клавиатуру.

Вот пример, показанный с CodePen:

```html
<button onclick='copyText("Copied!")'>  Click me to copy!</button>
```

```javascript
// This must be triggered by a user event.
function copyText (text) {
  // Create the textarea input to hold our text.
  const element = document.createElement('textarea');
  element.value = text;
  // Add it to the document so that it can be focused.
  document.body.appendChild(element);
  // Focus on the element so that it can be copied.
  element.focus();
  element.setSelectionRange(0, element.value.length);
  // Execute the copy command.
  document.execCommand('copy');
  // Remove the element to keep the document clear.
  document.body.removeChild(element);
}// This must be triggered by a user event.
function copyText (text) {
  // Create the textarea input to hold our text.
  const element = document.createElement('textarea');
  element.value = text;
  // Add it to the document so that it can be focused.
  document.body.appendChild(element);
  // Focus on the element so that it can be copied.
  element.focus();
  element.setSelectionRange(0, element.value.length);
  // Execute the copy command.
  document.execCommand('copy');
  // Remove the element to keep the document clear.
  document.body.removeChild(element);
}
```

Это должно быть вызвано пользовательским событием, например щелчком. Это функция безопасности, реализованная в важных операциях, таких как открытие окна загрузки файла, копирование в буфер обмена и т. Д. Она помогает защитить пользователей от веб-сайтов, взаимодействующих с их компьютером, когда они этого не хотят.

Несколько заметок:

* Вы можете использовать либо `input` с атрибутом type, установленным в text, либо` textarea`. Для последнего требуется на одну строку кода меньше, чтобы его создать.
* Вы можете прочитать, что для `document.execCommand` требуется` designmode`, но, насколько я могу судить, это не так. Это только должно быть вызвано инициированным пользователем событием.
* Вы, вероятно, хотите обернуть `document.execCommand` в блок try / catch. В некоторых браузерах выдает ошибку при сбоях.
* Вы можете проверить результат `execCommand`, чтобы увидеть, работает он или нет. Возвращает логическое значение, которое относится к успешному выполнению команды.

И это все! Теперь вы успешно копируете текст в буфер обмена!


**********
[буфер обмена](/tags/%D0%B1%D1%83%D1%84%D0%B5%D1%80%20%D0%BE%D0%B1%D0%BC%D0%B5%D0%BD%D0%B0.md)
